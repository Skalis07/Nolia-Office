# ğŸ§ª Nombre del workflow â€” aparecerÃ¡ en la pestaÃ±a â€œActionsâ€ de GitHub
name: CI â€” Lint & Build

# ğŸ“¦ Eventos que disparan el workflow
on:
  # 1ï¸âƒ£ Se ejecuta automÃ¡ticamente en cada Pull Request
  pull_request:

  # 2ï¸âƒ£ TambiÃ©n corre cuando hay push directo a main
  #    (por ejemplo, despuÃ©s de mergear un PR)
  push:
    branches: ["main"]

# ğŸ”’ Permisos mÃ­nimos necesarios
# (no despliega, solo lee el repo)
permissions:
  contents: read

# ğŸ§± DefiniciÃ³n de los trabajos (â€œjobsâ€) del pipeline
jobs:
  # --- JOB ÃšNICO: Lint + Build ---
  lint-and-build:
    name: lint-and-build
    # ğŸ”§ Sistema operativo donde se ejecutarÃ¡ el CI
    runs-on: ubuntu-latest

    # ğŸ§± Pasos del job
    steps:
      # Paso 1ï¸âƒ£ â€” Descargar el cÃ³digo del repositorio
      - name: Checkout
        uses: actions/checkout@v4

      # Paso 2ï¸âƒ£ â€” Configurar Node.js (versiÃ³n 20)
      # ğŸ‘‰ Se habilita cache automÃ¡tico de npm para acelerar el CI
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: "npm"

      # Paso 3ï¸âƒ£ â€” Instalar dependencias de forma limpia y reproducible
      # ğŸ‘‰ npm ci usa package-lock.json (ideal para CI)
      - name: Install dependencies
        run: npm ci

      # Paso 4ï¸âƒ£ â€” Ejecutar ESLint
      # ğŸ‘‰ Falla el job si hay errores de lint
      - name: Lint
        run: npm run lint

      # Paso 5ï¸âƒ£ â€” Ejecutar TypeScript typecheck
      # ğŸ‘‰ Falla el job si hay errores de tipos
      - name: Typecheck
        run: npm run typecheck

      # Paso 6ï¸âƒ£ â€” Ejecutar build de Astro
      # ğŸ‘‰ Detecta errores de compilaciÃ³n antes del merge
      - name: Build
        run: npm run build

      # Paso 7ï¸âƒ£ â€” Build con BASE_PATH para GitHub Pages (subpath)
      - name: Build (Pages)
        run: BASE_PATH=/Nolia-Office/ npm run build
